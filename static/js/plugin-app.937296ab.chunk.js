(self.webpackChunkdata_visualizer_app=self.webpackChunkdata_visualizer_app||[]).push([[2143],{7833:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>Bt});var n=a(3135),i=a(8594),l=a(4479),s=a(6329),o=a(3338),r=a(1006),d=a.n(r),u=a(4833),c=a(3665),p=a.n(c),m=a(2085),v=a(4977),h=a(4805),g=a(6609),b=a(2703),f=a(2150),y=a(9551),w=a(7427),x=a(7538),S=a(1054),E=a(6206),T=a.n(E),C=a(3491);const D={resource:"legendSets",params:e=>{let{ids:t}=e;return{fields:"id,displayName~rename(name),legends[id,displayName~rename(name),startValue,endValue,color]",filter:`id:in:[${t.join(",")}]`}}};var _=a(6259);var O=a(6373),z=a(4048),M=a(2410),k=a(7363),V=a(3912),q=a(2479),N=(a(5971),a(5805)),R=a(1949),P=a(2718),I=a(3883),L=a(222),Z=a(3353);const A="axisTitle",j="axisTitleTextMode",W="NORMAL",$={axes:{requestable:!1,savable:!0,defaultValue:[]},colorSet:{defaultValue:L.C7,requestable:!1,savable:!0},cumulativeValues:{defaultValue:!1,requestable:!1,savable:!0},hideEmptyRowItems:{defaultValue:"NONE",requestable:!1,savable:!0},seriesKey:{defaultValue:{},requestable:!1,savable:!0},legend:{defaultValue:{},requestable:!1,savable:!0},noSpaceBetweenColumns:{defaultValue:!1,requestable:!1,savable:!0},percentStackedValues:{defaultValue:!1,requestable:!1,savable:!0},regressionType:{defaultValue:"NONE",requestable:!1,savable:!0},showData:{defaultValue:!0,requestable:!1,savable:!0},aggregationType:{defaultValue:"DEFAULT",requestable:!0,savable:!0},completedOnly:{defaultValue:!1,requestable:!0,savable:!0},hideSubtitle:{defaultValue:!1,requestable:!1,savable:!0},hideTitle:{defaultValue:!1,requestable:!1,savable:!0},sortOrder:{defaultValue:"0",requestable:!1,savable:!0},subtitle:{defaultValue:void 0,requestable:!1,savable:!0},title:{defaultValue:void 0,requestable:!1,savable:!0},series:{defaultValue:[],requestable:!1,savable:!0},fontStyle:{defaultValue:{},requestable:!1,savable:!0},outlierAnalysis:{requestable:!1,savable:!0,defaultValue:null},icons:{defaultValue:!1,requestable:!1,savable:!0},colTotals:{defaultValue:!1,requestable:!1,savable:!0},colSubTotals:{defaultValue:!1,requestable:!1,savable:!0},rowTotals:{defaultValue:!1,requestable:!1,savable:!0},rowSubTotals:{defaultValue:!1,requestable:!1,savable:!0},showDimensionLabels:{defaultValue:!1,requestable:!1,savable:!0},hideEmptyColumns:{defaultValue:!1,requestable:!1,savable:!0},hideEmptyRows:{defaultValue:!1,requestable:!1,savable:!0},skipRounding:{defaultValue:!1,requestable:!0,savable:!0},numberType:{defaultValue:"VALUE",requestable:!1,savable:!0},showHierarchy:{defaultValue:!1,requestable:!0,savable:!0},displayDensity:{defaultValue:"NORMAL",requestable:!1,savable:!0},fontSize:{defaultValue:W,requestable:!1,savable:!0},digitGroupSeparator:{defaultValue:"SPACE",requestable:!1,savable:!0},approvalLevel:{defaultValue:void 0,requestable:!0,savable:!1},fixColumnHeaders:{defaultValue:!1,requestable:!1,savable:!0},fixRowHeaders:{defaultValue:!1,requestable:!1,savable:!0},reportingPeriod:{defaultValue:!1,requestable:!1,savable:!0},organisationUnit:{defaultValue:!1,requestable:!1,savable:!0},parentOrganisationUnit:{defaultValue:!1,requestable:!1,savable:!0},grandParentOrganisationUnit:{defaultValue:!1,requestable:!1,savable:!0},regression:{defaultValue:!1,requestable:!1,savable:!0},cumulative:{defaultValue:!1,requestable:!1,savable:!0},measureCriteria:{defaultValue:void 0,requestable:!0,savable:!0},topLimit:{defaultValue:"0",requestable:!1,savable:!0}},U=()=>Object.entries({...$}).reduce(((e,t)=>{let[a,n]=t;return e[a]=n.defaultValue,e}),{}),G=()=>Object.entries($).filter((e=>e[1].requestable)),F=e=>{var t;const a={...U(),...(0,Z.Z)(e,Object.keys($))};return a.axes=a.axes.map((e=>{if(e.targetLine||e.baseLine){const t={...e};return t.targetLine&&(t.targetLine={...t.targetLine,enabled:!0}),t.baseLine&&(t.baseLine={...t.baseLine,enabled:!0}),t}return e})),a.icons=Boolean(null===(t=e.icons)||void 0===t?void 0:t.length),e.reportingParams&&(a.organisationUnit=e.reportingParams.organisationUnit,a.reportingPeriod=e.reportingParams.reportingPeriod,a.parentOrganisationUnit=e.reportingParams.parentOrganisationUnit,a.grandParentOrganisationUnit=e.reportingParams.grandParentOrganisationUnit),["sortOrder","topLimit"].forEach((t=>{Object.prototype.hasOwnProperty.call(e,t)&&(a[t]=String(e[t]))})),a};var K=a(7545),B=a(3112),H=a(3945);K.default,B.i.dp24,K.default,B.i.dp24,K.default,B.i.dp16,H.O.grey300,B.i.dp8,K.default,K.default,B.i.dp12,H.O.grey900,K.default,H.O.grey600,K.default,B.i.dp8,K.default,B.i.dp16;const Y="jsx-1665807213",J=(K.default,B.i.dp8,K.default,B.i.dp8,H.O.grey700,K.default,B.i.dp4,"jsx-684239008");K.default,K.default,K.default,B.i.dp4,H.O.grey600;var Q=a(4149),X=a(6484);const ee=()=>m.createElement("svg",{height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},m.createElement("path",{d:"m7 5h6c2.209139 0 4 1.790861 4 4 0 .97998001-.3524116 1.8776499-.9374171 2.5731919 1.1608063.6986588 1.9374171 1.9720399 1.9374171 3.4268081 0 2.209139-1.790861 4-4 4h-7zm7 8h-5v4h5c1.1045695 0 2-.8954305 2-2 0-1.0543618-.8158778-1.9181651-1.8507377-1.9945143zm-1-6h-4v4h4c1.1045695 0 2-.8954305 2-2 0-1.0543618-.8158778-1.91816512-1.8507377-1.99451426z",fill:"#inherit"})),te=e=>{let{color:t}=e;return m.createElement("svg",{height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},m.createElement("circle",{cx:"12",cy:"12",fillRule:"evenodd",fill:t,r:"7"}))};te.defaultProps={color:"#000000"},te.propTypes={color:p().string};const ae=te,ne=()=>m.createElement("svg",{height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},m.createElement("path",{d:"m13.5 7h-3.5v-2h9v2h-3.5l-5 10h3.5v2h-9v-2h3.5z",fill:"#inherit"})),ie="TextStyle_container__wg3zm",le="TextStyle_buttonStrip__1IoTX",se="TextStyle_fontSizeSelect__1hlAu",oe="TextStyle_textAlignSelect__L738N",re="TextStyle_textColorLabel__TXegw",de="TextStyle_textColorInput__NsT9H",ue="TextStyle_textColorIcon__1EA56",ce="TextStyle_disabled__yqo+T",pe=e=>{let{fontStyleKey:t,fontStyle:a,visType:n,onChange:i,disabled:l,dataTest:s,isVertical:o}=e;const r=Object.values((0,q.yw)(t)),d=(0,q.Ml)(t,o||(0,f.jA)(n)),c=(0,u.Z)((e=>{i(q.vM,e)}),100);return m.createElement("div",{className:ie,"data-test":s},a[q.Jz]&&m.createElement(Q.q,{onChange:e=>{let{selected:t}=e;i(q.Jz,Number(t))},selected:(a[q.Jz]||"").toString(),prefix:_.Z.t("Size"),dense:!0,className:se,disabled:l,dataTest:`${s}-font-size-select`},r.map((e=>{var t,a,n;return m.createElement(X.a,{key:null===(t=e.value)||void 0===t?void 0:t.toString(),value:null===(a=e.value)||void 0===a?void 0:a.toString(),label:e.label,dataTest:`${s}-font-size-option-${null===(n=e.value)||void 0===n?void 0:n.toString()}`})}))),a[q.aS]&&m.createElement(Q.q,{onChange:e=>{let{selected:t}=e;i(q.aS,t)},selected:a[q.aS],prefix:_.Z.t("Position"),dense:!0,className:oe,disabled:l,dataTest:`${s}-text-align-select`},d.map((e=>{var t;return m.createElement(X.a,{key:e.value,value:e.value,label:e.label,dataTest:`${s}-text-align-option-${null===(t=e.value)||void 0===t?void 0:t.toString()}`})}))),m.createElement("div",{className:T()({[le]:a[q.vM]||a[q.G4]||a[q.ud]})},a[q.vM]&&m.createElement("label",{className:T()(re,{[ce]:l}),"data-test":`${s}-text-color-picker`},m.createElement("input",{type:"color",value:a[q.vM],onInput:e=>c(e.target.value),className:de,disabled:l}),m.createElement("div",{className:ue},m.createElement(ae,{color:a[q.vM]}))),null!=a[q.G4]&&m.createElement(x.z,{icon:m.createElement(ee,null),onClick:()=>{i(q.G4,!a[q.G4])},small:!0,secondary:!0,toggled:a[q.G4],disabled:l,dataTest:`${s}-bold-toggle`}),null!=a[q.ud]&&m.createElement(x.z,{icon:m.createElement(ne,null),onClick:()=>{i(q.ud,!a[q.ud])},small:!0,secondary:!0,disabled:l,toggled:a[q.ud],dataTest:`${s}-italic-toggle`})))};pe.propTypes={fontStyleKey:p().string.isRequired,dataTest:p().string,disabled:p().bool,fontStyle:p().object,isVertical:p().bool,visType:p().string,onChange:p().func};const me=(0,V.$j)(((e,t)=>({fontStyle:_e(e,{id:t.fontStyleKey,axisId:t.axisId})||{},visType:De(e)})),((e,t)=>({onChange:(a,n)=>e(Me({optionId:t.fontStyleKey,axisId:t.axisId,fontStyleOption:a,value:n}))})))(pe),ve="AUTO",he="NONE",ge="CUSTOM",be=["#4292c6","#cb181d","#41ab5d","#6c66b8"],fe=e=>{let{axisId:t,fontStyleKey:a,textMode:n,onTextChange:i,onTextModeChange:l,title:s,hasCustomAxes:o,setTitleColor:r,fontStyle:d,setFontStyle:u,showAutoOption:c}=e;const p=e=>{let{value:n}=e;l(n),n!==ve&&n!==ge||!o||d[q.vM]!==q.U6[a][q.vM]?n===he&&i(null):r(be[t.slice(-1)])};return m.createElement("div",{className:Y,"data-test":"option-chart-title"},m.createElement(N._,null,_.Z.t("Axis title")),m.createElement(R.g,{name:"title-selector",dense:!0},[...c?[{id:ve,label:_.Z.t("Auto generated from axis items")}]:[],{id:he,label:_.Z.t("None")},{id:ge,label:_.Z.t("Custom")}].map((e=>{let{id:t,label:a}=e;return m.createElement(P.Y,{key:t,label:a,value:t,dense:!0,onChange:p,checked:n===t})}))),n===ge?m.createElement("div",{className:J},m.createElement(I.U,{type:"text",onChange:e=>{let{value:t}=e;return i(t)},value:s,placeholder:_.Z.t("Add a title"),inputWidth:"280px",dense:!0,dataTest:`${t}-axis-title-input`})):null,n===ve||n===ge?m.createElement("div",{className:J},m.createElement(me,{fontStyleKey:a,dataTest:`${t}-axis-title-text-style`,axisId:t}),m.createElement(x.z,{onClick:()=>{u(o?{textColor:be[t.slice(-1)]}:{})},disabled:Object.keys(d).every((e=>(e!==q.vM||!o)&&d[e]===q.U6[a][e]||e===q.vM&&o&&d[e]===be[t.slice(-1)])),small:!0},_.Z.t("Reset style to default"))):null)};fe.propTypes={axisId:p().string,fontStyle:p().object,fontStyleKey:p().string,hasCustomAxes:p().bool,setFontStyle:p().func,setTitleColor:p().func,showAutoOption:p().bool,textMode:p().string,title:p().string,onTextChange:p().func,onTextModeChange:p().func};(0,V.$j)(((e,t)=>({fontStyle:_e(e,{id:t.fontStyleKey,axisId:t.axisId})||{},title:_e(e,{axisId:t.axisId,id:A}),textMode:_e(e,{id:j,axisId:t.axisId})||he})),((e,t)=>({onTextChange:a=>e(Me({optionId:A,axisId:t.axisId,value:a})),onTextModeChange:a=>e(Me({optionId:j,axisId:t.axisId,value:a})),setTitleColor:a=>e(Me({optionId:t.fontStyleKey,axisId:t.axisId,fontStyleOption:q.vM,value:a})),setFontStyle:a=>e(ke({optionId:t.fontStyleKey,axisId:t.axisId,value:a}))})))(fe);const ye="name",we=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{[ye]:e,...t}},xe={reportTable:[we("cumulative",{option:!0}),we("hideEmptyColumns",{option:!0}),we("measureCriteria",{option:!0}),we("numberType",{option:!0}),we("regression",{option:!0}),we("reportingParams",{option:!0}),we("skipRounding",{option:!0}),we("fixColumnHeaders",{option:!0}),we("fixRowHeaders",{option:!0})],chart:[we("category",{excluded:!0}),we("icons",{option:!0}),we("yearlySeries")],eventReport:[we("dataType")],reportTable_eventReport:[we("colSubTotals",{option:!0}),we("colTotals",{option:!0}),we("displayDensity",{option:!0}),we("fontSize",{option:!0}),we("hideEmptyRows",{option:!0}),we("rowSubTotals",{option:!0}),we("rowTotals",{option:!0}),we("showDimensionLabels",{option:!0}),we("showHierarchy",{option:!0})],chart_eventChart:[we("axes",{option:!0}),we("colorSet",{option:!0}),we("cumulativeValues",{option:!0}),we("fontStyle",{option:!0}),we("hideEmptyRowItems",{option:!0}),we("seriesKey",{option:!0}),we("legend",{option:!0}),we("noSpaceBetweenColumns",{option:!0}),we("percentStackedValues",{option:!0}),we("regressionType",{option:!0}),we("series",{option:!0}),we("showData",{option:!0}),we("outlierAnalysis",{option:!0}),we("type",{option:!0})],eventReport_eventChart:[we("attributeValueDimension"),we("collapseDataDimensions"),we("dataElementValueDimension"),we("endDate"),we("eventStatus",{option:!0}),we("hideNaData",{option:!0}),we("outputType",{option:!0}),we("program"),we("programStage"),we("programStatus",{option:!0}),we("startDate"),we("value")],reportTable_eventReport_eventChart:[we("columnDimensions",{excluded:!0}),we("rowDimensions",{excluded:!0})],reportTable_chart_eventReport_eventChart:[we("access"),we("aggregationType",{option:!0}),we("attributeDimensions",{excluded:!0}),we("attributeValues",{excluded:!0}),we("categoryDimensions",{excluded:!0}),we("categoryOptionGroupSetDimensions",{excluded:!0}),we("code",{excluded:!0}),we("columns"),we("completedOnly",{option:!0}),we("created"),we("dataDimensionItems"),we("dataElementDimensions",{excluded:!0}),we("dataElementGroupSetDimensions",{excluded:!0}),we("description"),we("digitGroupSeparator"),we("displayDescription"),we("displayName"),we("displayShortName"),we("displaySubtitle"),we("displayTitle"),we("externalAccess",{excluded:!0}),we("favorite"),we("favorites"),we("filterDimensions",{excluded:!0}),we("filters"),we("hideSubtitle",{option:!0}),we("hideTitle",{option:!0}),we("href"),we("id"),we("interpretations"),we("itemOrganisationUnitGroups",{excluded:!0}),we("lastUpdated"),we("lastUpdatedBy"),we("name"),we("organisationUnitGroupSetDimensions",{excluded:!0}),we("organisationUnitLevels",{excluded:!0}),we("organisationUnits",{excluded:!0}),we("parentGraphMap"),we("periods",{excluded:!0}),we("programIndicatorDimensions",{excluded:!0}),we("publicAccess"),we("relativePeriods",{excluded:!0}),we("rows"),we("shortName"),we("sorting"),we("sortOrder",{option:!0}),we("subscribed"),we("subscribers"),we("subtitle",{option:!0}),we("timeField"),we("title",{option:!0}),we("topLimit",{option:!0}),we("translations"),we("user"),we("userAccesses"),we("userGroupAccesses"),we("userOrganisationUnit",{excluded:!0}),we("userOrganisationUnitChildren",{excluded:!0}),we("userOrganisationUnitGrandChildren",{excluded:!0})]};xe.visualization=[...xe.reportTable,...xe.chart,...xe.reportTable_eventReport,...xe.chart_eventChart,...xe.reportTable_eventReport_eventChart,...xe.reportTable_chart_eventReport_eventChart];const Se=e=>{var t;return null!==(t=e.sorting)&&void 0!==t&&t.length?{dimension:e.sorting[0].dimension,direction:e.sorting[0].direction.toLowerCase()}:void 0},Ee="SET_UI_OPTION",Te="SET_UI_OPTION_FONT_STYLE",Ce=(f.Ef,U(),h.a5,h.vi,h.rx,h.rx,h.vi,e=>e.ui),De=e=>Ce(e).type,_e=(e,t)=>{var a,n,i,l,s,o,r,d,u,c,p,m,v,h,g,b,f,y,w,x,S,E,T;const C=Ce(e).options,[D,_]=(t.axisId||"").split("_");let O;if(t.name)O=C[t.name];else if(t.id)switch(t.id){case"maxValue":case"minValue":case"decimals":case"steps":O=Oe(C.axes,Number(_),D)[t.id];break;case j:O=null===(a=Oe(C.axes,Number(_),D).title)||void 0===a?void 0:a.textMode;break;case A:O=null===(n=Oe(C.axes,Number(_),D).title)||void 0===n?void 0:n.text;break;case"showSeriesKey":O=null===(i=C.seriesKey)||void 0===i?void 0:i.hidden;break;case"legendDisplayStrategy":O=null===(l=C.legend)||void 0===l?void 0:l.strategy;break;case"legendDisplayStyle":O=null===(s=C.legend)||void 0===s?void 0:s.style;break;case"showLegendKey":O=null===(o=C.legend)||void 0===o?void 0:o.showKey;break;case"legendSet":O=null===(r=C.legend)||void 0===r?void 0:r.set;break;case q.cN:O=ze(t.id,null===(d=C.seriesKey)||void 0===d||null===(u=d.label)||void 0===u?void 0:u.fontStyle);break;case"baseLineEnabled":O=null===(c=Oe(C.axes,Number(_),D).baseLine)||void 0===c?void 0:c.enabled;break;case"baseLineTitle":O=null===(p=Oe(C.axes,Number(_),D).baseLine)||void 0===p||null===(m=p.title)||void 0===m?void 0:m.text;break;case"baseLineValue":O=null===(v=Oe(C.axes,Number(_),D).baseLine)||void 0===v?void 0:v.value;break;case"baseLineTitleFontStyle":O=ze(q.Yb,null===(h=Oe(C.axes,Number(_),D).baseLine)||void 0===h||null===(g=h.title)||void 0===g?void 0:g.fontStyle);break;case"targetLineEnabled":O=null===(b=Oe(C.axes,Number(_),D).targetLine)||void 0===b?void 0:b.enabled;break;case"targetLineTitle":O=null===(f=Oe(C.axes,Number(_),D).targetLine)||void 0===f||null===(y=f.title)||void 0===y?void 0:y.text;break;case"targetLineValue":O=null===(w=Oe(C.axes,Number(_),D).targetLine)||void 0===w?void 0:w.value;break;case"targetLineTitleFontStyle":O=ze(q.Yb,null===(x=Oe(C.axes,Number(_),D).targetLine)||void 0===x||null===(S=x.title)||void 0===S?void 0:S.fontStyle);break;case q.bW:O=ze(t.id,null===(E=Oe(C.axes,Number(_),D).label)||void 0===E?void 0:E.fontStyle);break;case q.JS:case q.y$:O=ze(t.id,null===(T=Oe(C.axes,Number(_),D).title)||void 0===T?void 0:T.fontStyle);break;case q.ML:case q.pR:O=ze(t.id,(C.fontStyle||{})[t.id])}return O},Oe=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;return{...e.find((e=>e.index===t&&e.type===a))||{index:Number(t),type:a}}},ze=(e,t)=>({...q.U6[e],...t||{}}),Me=e=>({type:Ee,value:e}),ke=e=>({type:Te,value:e});var Ve=a(4271);const qe=e=>{let{methods:t,currentMethodId:a,onMethodChange:n,currentThreshold:i,onThresholdChange:l}=e;return m.createElement(m.Fragment,null,m.createElement("div",{className:Y},m.createElement(R.g,{dataTest:"options-outliers-detection-method",dense:!0},t.map((e=>{let{id:t,label:i}=e;return m.createElement(P.Y,{key:t,label:i,value:t,checked:a===t,onChange:e=>{let{value:t}=e;n(t)},dense:!0})}))),m.createElement(Ve.W,null,_.Z.t("Each detection method identifies outliers in different ways and suits different data. Check the documentation for help to choose the right outlier detection method"))),m.createElement(I.U,{type:"number",label:_.Z.t("Threshold factor"),min:"0",step:"0.5",onChange:e=>{let{value:t}=e;return l(t)},value:(null==i?void 0:i.toString())||"",helpText:_.Z.t("A high value is more sensitive so fewer data items will be identified as outliers"),placeholder:_.Z.t("Number"),inputWidth:"96px",dense:!0,dataTest:"options-outliers-threshold"}))};qe.propTypes={methods:p().array.isRequired,onMethodChange:p().func.isRequired,onThresholdChange:p().func.isRequired,currentMethodId:p().string,currentThreshold:p().number};const Ne="STANDARD_Z_SCORE",Re="MODIFIED_Z_SCORE";_.Z.t("Z-score / Standard score"),_.Z.t("Modified Z-score");var Pe=a(8943);h.a5,h.rx,h.vi;const Ie=e=>(0,Pe.CU)(k.fW).getPeriods().find((t=>t.id===e[0].id))?k.fW:(0,Pe.CU)(k.O5).getPeriods().find((t=>t.id===e[0].id))?k.O5:void 0,Le=h.vi,Ze=async(e,t,a)=>{const n=M.Z.getAnalytics(e),i=(new n.request).fromVisualization(t).withParameters(a).withIncludeNumDen(t.type===f.Zp),l=await n.aggregate.get(i);return[new n.response(l)]},Ae=e=>{let{analyticsEngine:t,visualization:a,options:n,forDownload:i=!1}=e;const l=(e=>{let{showHierarchy:t}=e;return{[h.a5]:"dxname",[h.rx]:t?"ounamehierarchy":"ouname",[h.vi]:"pename"}})(n),s={...n,maxResults:a.outlierAnalysis.maxResults,algorithm:a.outlierAnalysis.outlierMethod===Ne?"Z_SCORE":a.outlierAnalysis.outlierMethod,threshold:a.outlierAnalysis.thresholdFactor},o=a.columns||[],r=[];switch(o.forEach((e=>{let{dimension:t,items:a}=e;s[t]=t===h.vi?a[0].id:a.map((e=>{let{id:t}=e;return t})).join(","),r.push(i?t:l[t]),t===h.a5&&r.push("cocname")})),r.push("value"),a.outlierAnalysis.outlierMethod){case Re:r.push("median","modifiedzscore","medianabsdeviation");break;case Ne:r.push("mean","zscore","stddev")}r.push("lowerbound","upperbound"),s.headers=r.join(",");const d=Se(a);return d&&(s.orderBy=d.dimension,s.sortOrder=d.direction),(new t.request).withParameters(s)},je=async(e,t,a)=>{const n=M.Z.getAnalytics(e),i=Ae({analyticsEngine:n,visualization:t,options:a}),l=await n.aggregate.getOutliersData(i);return[new n.response(l)]},We=e=>{let{yearlySeriesRes:t,currentMonth:a,currentDay:n}=e;const i=[],l=[],s=t.metaData.dimensions[Le].slice().sort().reverse(),o="02"===a&&"29"===n;return s.forEach((e=>{i.push(t.metaData.items[e].name);const s=29===new Date(e,1,29).getDate();o&&!s?l.push(`${e}-02-28`):l.push(`${e}-${a}-${n}`)})),{yearlySeriesLabels:i,periodDates:l}},$e=async e=>{let{analyticsEngine:t,visualization:a,options:n,yearlySeriesRes:i,currentMonth:l,currentDay:s}=e;const o=[],r=[],d=i.metaData.dimensions[Le].slice().sort().reverse(),u=d.shift();o.push(i.metaData.items[u].name),r.push(`${u}-${l}-${s}`);const c=(new t.request).fromVisualization(a).withParameters(n).withRelativePeriodDate(`${u}-${l}-${s}`).withSkipData(!0).withSkipMeta(!1),p=(await t.aggregate.fetch(c)).metaData.dimensions[Le].pop(),[m,v]=p.split("W"),h=u-m,g=d.reduce(((e,t)=>(o.push(i.metaData.items[t].name),e.push(`${t-h}W${v}`),"53"===v&&e.push(t-h+"W52"),e)),[]);if(g.length){const e=(new t.request).addPeriodDimension(g).withSkipData(!0).withSkipMeta(!1).withIncludeMetadataDetails(!0),a=await t.aggregate.fetch(e),n=[];a.metaData.dimensions[Le].sort().reverse().forEach((e=>{const t=e.substr(0,4);if(!n.includes(t)){const i=new Date(a.metaData.items[e].endDate);i.setDate(i.getDate()+1),r.push(`${i.getFullYear()}-${(""+(i.getMonth()+1)).padStart(2,0)}-${(""+i.getDate()).padStart(2,0)}`),n.unshift(t)}}))}return{yearlySeriesLabels:o,periodDates:r}},Ue=e=>(e||[]).map((e=>{var t;return{...e,items:null==e||null===(t=e.items)||void 0===t?void 0:t.filter((e=>e.id!==O.aW))}})),Ge=async e=>{let{dataEngine:t,visualization:a,filters:n,forDashboard:i,displayProperty:l}=e;const s={...a,columns:Ue(a.columns),rows:Ue(a.rows),filters:Ue(a.filters)},o=((e,t,a)=>{const n=G().reduce(((t,a)=>{let[n,i]=a;return void 0!==e[n]&&e[n]!==i.defaultValue&&(t[n]=e[n]),t}),{});if(t.relativePeriodDate&&(n.relativePeriodDate=t.relativePeriodDate),a&&(n.displayProperty=a.toUpperCase()),t.userOrgUnit&&t.userOrgUnit.length){const e=t.userOrgUnit.map((e=>e.split("/").slice(-1)[0]));n.userOrgUnit=e.join(";")}return n})(s,n,l),r={dashboard:i};if((0,f.zD)(s.type)){const{responses:e,yearlySeriesLabels:a}=await(async(e,t,a)=>{const n=M.Z.getAnalytics(e);let i=(new n.request).addPeriodDimension(t.yearlySeries).withSkipData(!0).withSkipMeta(!1).withIncludeMetadataDetails(!0);a.relativePeriodDate&&(i=i.withRelativePeriodDate(a.relativePeriodDate));const l=await n.aggregate.fetch(i),s=[],o=[],r=new Date,d=(""+r.getDate()).padStart(2,0),u=(""+(r.getMonth()+1)).padStart(2,0),c=(0,z.Z)(t,Le);if(Ie(c)===k.fW&&!c[0].id===k.uu){const e=await $e({analyticsEngine:n,visualization:t,options:a,yearlySeriesRes:l,currentMonth:u,currentDay:d});s.push(...e.periodDates),o.push(...e.yearlySeriesLabels)}else if(Ie(c)===k.O5){const e=We({yearlySeriesRes:l,currentMonth:u,currentDay:d});s.push(...e.periodDates),o.push(...e.yearlySeriesLabels)}else l.metaData.dimensions[Le].sort().reverse().forEach((e=>{o.push(l.metaData.items[e].name),s.push(`${e}-${u}-${d}`)}));const p=s.reduce(((e,i)=>{const l=(new n.request).fromVisualization(t).withParameters(a).withRelativePeriodDate(i);return e.push(n.aggregate.get(l)),e}),[]);return Promise.all(p).then((e=>({responses:e.map((e=>new n.response(e))),yearlySeriesLabels:o})))})(t,s,o),n=(0,z.Z)(s,h.vi),i=Ie(n),l=((e,t)=>{const a=e.reduce(((e,t)=>(e.push(t.metaData.dimensions.pe),e)),[]);if(t===k.O5){a.sort(((e,t)=>e[0].substr(-2)-t[0].substr(-2)));const e=a.shift().map((e=>[e]));return a.forEach((t=>{t.forEach((t=>{const a=t.match(/(\d{4})(\d{2})(\d{2})/),n=a[2],i=a[3],l=e.findIndex((e=>e[0].substr(4)===`${n}${i}`));if(-1!==l)e[l].push(t);else if("02"===n&&"29"===i){const a=e.findIndex((e=>-1!==e.findIndex((e=>/0228$/.test(e)))));-1!==a?e.splice(a+1,0,[t]):e.push([t])}else e.push([t])}))})),e}if(t===k.fW){a.sort(((e,t)=>t[0].split("W")[1]-e[0].split("W")[1]));const e=a.shift().map((e=>[e]));return a.forEach((t=>{t.forEach((t=>{const[a,n]=t.split("W"),i=e.findIndex((e=>e[0].split("W")[1]===n));if(-1!==i)e[i].push(t);else if("1"===n){const a=e.findIndex((e=>-1!==e.findIndex((e=>/W2$/.test(e)))));-1!==a?e[a].push(t):e.push([t])}else{const i=e.findIndex((e=>-1!==e.findIndex((e=>e===`${a}W${n-1}`))));e.splice(i+1,0,[t])}}))})),e}{const e=a.reduce(((e,t)=>(t.forEach(((t,a)=>{e[a].push(t)})),e)),Array.from({length:a[0].length},(()=>[])));return e}})(e,i),d=l.reduce(((e,t,a)=>(t.forEach((t=>e[t]=a)),e)),{}),u=i?((e,t)=>{switch(t){case k.fW:return e.map((e=>e[0].substr(4))).flat();case k.O5:return e.map((e=>e[0].substr(4).replace(/(\d{2})(\d{2})/,"$2-$1"))).flat()}})(l,i):(e=>{const t=e.reduce(((e,t)=>(e.metaData?t.metaData.dimensions.pe.length>e.metaData.dimensions.pe.length&&(e=t):e=t,e)),{}).metaData;return t.dimensions.pe.reduce(((e,a)=>{const n=t.items[a].name;return e.push(n.replace(/\s+\d{4}$/,"")),e}),[])})(e);return{responses:e,extraOptions:{...r,yearlySeries:a,xAxisLabels:u,periodKeyAxisIndexMap:d}}}return(0,f.oW)(s.type)?{responses:await je(t,s,o),extraOptions:r}:{responses:await Ze(t,s,o),extraOptions:r}};var Fe=a(4970);const Ke=e=>{let{visualization:t,responses:a,extraOptions:n,legendSets:i,id:l,style:s,onChartGenerated:o,animation:r,onToggleContextualMenu:d}=e;const u=(0,m.useRef)(void 0),c=(0,m.useRef)(s),p=(0,m.useRef)(l),v=(0,m.useCallback)((e=>{const l=(0,Fe.cw)(a,t,u.current,{...n,animation:e,legendSets:i,onToggleContextualMenu:d},void 0,void 0,(0,f.Nh)(t.type)?"dhis":"highcharts");(0,f.Nh)(t.type)?o(l.visualization):o(l.visualization.getSVGForExport({sourceHeight:768,sourceWidth:1024}))}),[u,t,o,d,a,n,i]);return(0,m.useEffect)((()=>{v(r)}),[t,a,n]),(0,m.useEffect)((()=>{l!==p.current&&(v(0),p.current=l)}),[l]),(0,m.useEffect)((()=>{s.width===c.current.width&&s.height===c.current.height||(v(0),c.current=s)}),[s]),m.createElement("div",{ref:u,style:s})};Ke.defaultProps={visualization:{},filters:{},style:{},animation:200,id:null,onChartGenerated:Function.prototype},Ke.propTypes={extraOptions:p().object.isRequired,legendSets:p().arrayOf(p().object).isRequired,responses:p().arrayOf(p().object).isRequired,visualization:p().object.isRequired,animation:p().number,id:p().number,style:p().object,onChartGenerated:p().func,onToggleContextualMenu:p().func};const Be=Ke;var He=a(4196),Ye=a(9676),Je=a(1463),Qe=a(4813);const Xe=e=>{let{style:t={width:18,height:18}}=e;return m.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",style:t},m.createElement("path",{d:"M0 0h24v24H0V0z",fill:"none"}),m.createElement("path",{d:"M20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8 8-8z",fill:"black"}))};Xe.propTypes={style:p().object};const et=Xe,tt=e=>{let{style:t={width:18,height:18}}=e;return m.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",style:t},m.createElement("path",{d:"M0 0h24v24H0V0z",fill:"none"}),m.createElement("path",{d:"M4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8-8 8z",fill:"black"}))};tt.propTypes={style:p().object};const at=tt,nt=e=>{let{config:t,ouLevels:a,onClick:i,reference:l,dataTest:s}=e;const o=(0,n.bQ)(),[r,d]=(0,m.useState)(void 0),[u,c]=(0,m.useState)(void 0),p=(0,m.useCallback)((async e=>await(0,g.M7)(o,e)),[o]);(0,m.useEffect)((()=>{d(null);t.ouId&&(async()=>{const e=await p(t.ouId);d(e)})()}),[t]),(0,m.useEffect)((()=>{if(c(null),null!=r&&r.children.length){const t=(e=r.children[0].level,a.find((t=>t.level===e)));t&&c(t)}var e}),[r]);const v={display:"inline-block",minWidth:200};return r?m.createElement(He.r,{reference:l,placement:"right-start",dataTest:s},m.createElement(Ye.q,null,m.createElement(Je.s,{dense:!0,label:_.Z.t("Change org unit"),dataTest:`${s}-org-unit`},(null==r?void 0:r.parent)&&m.createElement(m.Fragment,null,m.createElement(Je.s,{dense:!0,icon:m.createElement(at,null),label:m.createElement("span",{style:v},r.parent.name),onClick:()=>i({ou:{id:r.parent.id}}),dataTest:`${s}-org-unit-drill-up`}),u&&m.createElement(Qe.i,null)),u&&m.createElement(Je.s,{dense:!0,icon:m.createElement(et,null),label:m.createElement("span",{style:v},_.Z.t("{{level}} level in {{orgunit}}",{level:u.name,orgunit:r.name})),onClick:()=>i({ou:{id:r.id,path:r.path,level:u.id}}),dataTest:`${s}-org-unit-drill-down`})))):null};nt.propTypes={config:p().object,dataTest:p().string,ouLevels:p().array,reference:p().object,onClick:p().func};const it=nt;var lt=a(1475),st=a(6098),ot=a(7646),rt=a(9308),dt=a(5215),ut=a(1250),ct=a(9647),pt=a(6765),mt=a(101);const vt="OutlierTablePlugin_pluginContainer__DW9Af",ht="OutlierTablePlugin_visualizationContainer__oKzpm",gt="OutlierTablePlugin_dataTable__iG5c9",bt="OutlierTablePlugin_headerCell__ZHDYk",ft="OutlierTablePlugin_fontSizeLarge__W+TKN",yt="OutlierTablePlugin_fontSizeNormal__Vfxb9",wt="OutlierTablePlugin_fontSizeSmall__B50-N",xt="OutlierTablePlugin_sizeComfortable__C+BHi",St="OutlierTablePlugin_sizeNormal__SKU6y",Et="OutlierTablePlugin_sizeCompact__Mnet+",Tt="OutlierTablePlugin_cell__AsAKf",Ct="OutlierTablePlugin_nowrap__a7IqD",Dt=e=>{let{filters:t,responses:a,visualization:n,onDataSorted:i}=e;const l=a[0],s=(()=>{var e,t,a,n;const i=(0,h.ln)();return{dxname:{label:null===(e=i[h.a5])||void 0===e?void 0:e.name},ouname:{label:null===(t=i[h.rx])||void 0===t?void 0:t.name},ounamehierarchy:{label:null===(a=i[h.rx])||void 0===a?void 0:a.name},pename:{label:null===(n=i[h.vi])||void 0===n?void 0:n.name},cocname:{label:_.Z.t("Category option combination")},value:{label:_.Z.t("Value")},absdev:{label:_.Z.t("Absolute deviation"),tooltip:_.Z.t("A measure of the absolute difference between each data point and a central value, usually the mean or median, providing a straightforward understanding of dispersion in the dataset.")},modifiedzscore:{label:_.Z.t("Modified Z-score"),tooltip:_.Z.t("A measure of how far a data point deviates from the median, using the median absolute deviation instead of the standard deviation, making it robust against outliers.")},median:{label:_.Z.t("Median"),tooltip:_.Z.t("The middle value in a dataset when the values are arranged in ascending or descending order. It's a robust measure of central tendency that is less affected by outliers compared to the mean.")},medianabsdeviation:{label:_.Z.t("Median absolute deviation"),tooltip:_.Z.t("A robust measure of variability, found by calculating the median of the absolute differences between each data point and the overall median. It's less influenced by outliers compared to other measures like the standard deviation.")},zscore:{label:_.Z.t("Z-score"),tooltip:_.Z.t("A measure of how many standard deviations a data point is from the mean of a dataset, providing insight into how unusual or typical that data point is relative to the rest of the distribution.")},mean:{label:_.Z.t("Mean"),tooltip:_.Z.t("Average of the value over time.")},stddev:{label:_.Z.t("Standard deviation"),tooltip:_.Z.t("A measure of how dispersed the data is in relation to the mean. Low standard deviation indicates data are clustered tightly around the mean, and high standard deviation indicates data are more spread out.")},lowerbound:{label:_.Z.t("Min"),tooltip:_.Z.t("Minimum score threshold")},upperbound:{label:_.Z.t("Max"),tooltip:_.Z.t("Maximum score threshold")}}})(n.showHierarchy),o=(0,m.useRef)(null),[r,d]=(0,m.useState)({containerMaxWidth:0,paginationMaxWidth:0,noticeBoxMaxWidth:0}),u=(0,m.useMemo)((()=>({dimension:"value",direction:"desc"})),[]),c=(0,m.useCallback)((e=>{const t=Se(e)||u;return{sortField:t.dimension,sortDirection:t.direction}}),[u]),{sortField:p,sortDirection:v}=c(n),g=(e=>{switch(e){case"COMFORTABLE":return xt;case"COMPACT":return Et;default:return St}})(n.displayDensity),b=(e=>{switch(e){case"LARGE":return ft;case"SMALL":return wt;default:return yt}})(n.fontSize),f=!(null==t||!t.relativePeriodDate),y=(0,m.useCallback)((()=>{if(null==o||!o.current||0===o.current.clientWidth)return;const e=o.current.clientWidth,t=o.current.querySelector(".tablescrollbox"),a=t.offsetWidth-t.clientWidth,n=e-a;d({containerMaxWidth:n,paginationMaxWidth:n-a,noticeBoxMaxWidth:t.offsetWidth})}),[]),w=(0,m.useMemo)((()=>new window.ResizeObserver(y)),[y]),x=(0,m.useCallback)((e=>{if(null!==e)return o.current=e,w.observe(e),w.disconnect}),[w]),S=e=>{let{name:t}=e;i({dimension:t,direction:p===t&&"desc"===v?"asc":"desc"})};return m.createElement("div",{className:vt,ref:x},m.createElement("div",{"data-test":"visualization-container",className:ht,style:{maxWidth:r.containerMaxWidth}},m.createElement(dt.w,{scrollHeight:(e=>e?"calc(100vh - 285px)":"100%")(f),scrollWidth:"100%",width:"auto",className:T()(gt,"push-analytics-outlier-table"),dataTest:"outlier-table"},m.createElement(ut.s,null,m.createElement(ct.U,null,l.headers.map((e=>(e=>{var t,a;let{name:n,valueType:i}=e;const l=null===(t=s[n])||void 0===t?void 0:t.label,o=null===(a=s[n])||void 0===a?void 0:a.tooltip;return m.createElement(ot.p,{fixed:!0,top:"0",key:n,name:n,onSortIconClick:i!==lt.FV?void 0:S,sortDirection:i!==lt.FV?void 0:n===p?v:"default",sortIconTitle:n===p&&"desc"===v?_.Z.t("Sort ascending by {{columnName}} and update",{columnName:l}):_.Z.t("Sort descending by {{columnName}} and update",{columnName:l}),className:T()(bt,b,g,"bordered"),dataTest:"table-header"},o?m.createElement(rt.u,{content:o},l):l)})(e))))),m.createElement(pt.R,{dataTest:"table-body"},l.rows.map(((e,t)=>m.createElement(ct.U,{key:t,dataTest:"table-row"},e.map(((e,t)=>{return m.createElement(mt.W,{key:t,className:T()(Tt,b,g,{[Ct]:(a=l.headers[t],[lt.FV,lt.$r,lt.VX,lt.M7,lt.iq,lt.y3,lt.SA,lt.zf,lt.$d,lt.Wt].includes(a.valueType))},"bordered"),dataTest:"table-cell"},((e,t)=>(0,st.Q)(e,t.valueType||lt.kl,t.optionSet?{}:{digitGroupSeparator:n.digitGroupSeparator,skipRounding:!1}))(e,l.headers[t]));var a})))))))))};Dt.defaultProps={style:{},onDataSorted:Function.prototype},Dt.propTypes={responses:p().arrayOf(p().object).isRequired,visualization:p().object.isRequired,filters:p().object,onDataSorted:p().func};const _t=Dt;var Ot=a(4521);const zt=e=>{let{responses:t,legendSets:a,visualization:n,style:i,id:l,onToggleContextualMenu:s}=e;return m.createElement("div",{style:i},m.createElement(Ot.Z,{visualization:n,data:t[0].response,legendSets:a,renderCounter:l,onToggleContextualMenu:s}))};zt.defaultProps={style:{}},zt.propTypes={legendSets:p().arrayOf(p().object).isRequired,responses:p().arrayOf(p().object).isRequired,visualization:p().object.isRequired,id:p().number,style:p().object,onToggleContextualMenu:p().func};const Mt=zt,kt="VisualizationPlugin_container__zLI-6",Vt="VisualizationPlugin_modal__aqvfr",qt="VisualizationPlugin_chartWrapper__qJc7d",Nt="VisualizationPlugin_legendKey__rY4a7",Rt="VisualizationPlugin_legendKeyToggle__yN1ab",Pt="VisualizationPlugin_wrapper__qtDqn",It="VisualizationPlugin_buttonMargin__Zo0d5",Lt=e=>{var t,a;let{visualization:l,displayProperty:s,filters:o,forDashboard:r,id:d,isInModal:u,style:c,onChartGenerated:p,onError:v,onLoadingComplete:E,onDataSorted:O,onResponsesReceived:z,onDrill:M}=e;const k=(0,n.bQ)(),[V,q]=(0,m.useState)(void 0),[N,R]=(0,m.useState)(void 0),[P,I]=(0,m.useState)(null),[L,Z]=(0,m.useState)(void 0),[A,j]=(0,m.useState)({}),[W,$]=(0,m.useState)(!1),[U,G]=(0,m.useState)(d),[K,B]=(0,m.useState)({width:0,height:0}),H=(0,m.useCallback)((e=>{if(null===e||0===e.clientWidth&&0===e.clientHeight)return;const t=()=>B({width:e.clientWidth,height:e.clientHeight}),a=new window.ResizeObserver(t);return a.observe(e),t(),a.disconnect}),[]);(0,m.useEffect)((()=>G(d)),[d]);const Y=(e,t)=>{if(t.ouId)j(t),Z(e);else if(t.category&&(1===V.rows.length&&V.rows[0].dimension===h.rx||2===V.rows.length&&V.rows[1].dimension===h.rx)){var a;const n=null===(a=Object.values(P.responses[0].metaData.items).find((e=>e.name===t.category&&P.responses[0].metaData.dimensions[h.rx].includes(e.uid))))||void 0===a?void 0:a.uid;j({ouId:n}),Z(e)}else if(t.category&&V.columns.some((e=>e.dimension===h.rx))){var n;const a=null===(n=Object.values(P.responses[0].metaData.items).find((e=>e.name===t.series&&P.responses[0].metaData.dimensions[h.rx].includes(e.uid))))||void 0===n?void 0:n.uid;j({ouId:a}),Z(e)}},J=()=>Z(void 0),Q=(0,m.useCallback)((async(e,t,a)=>{const n=await Ge({dataEngine:k,visualization:e,filters:t,forDashboard:a,displayProperty:s});return n.responses.length&&z(n.responses),n}),[k,s,z]),X=(0,m.useCallback)((async e=>{if(!e.length)return[];return await(async(e,t)=>(await e.query({legendSets:D},{variables:{ids:t}})).legendSets.legendSets)(k,e)}),[k]);if((0,m.useEffect)((()=>{(async()=>{const e=await(0,g.qB)(k);R(e)})()}),[k]),(0,m.useEffect)((()=>{I(null);const e=(e=>{let{visType:t,options:a}=e;const n={};for(const[e,i]of Object.entries(a))switch(e){case"cumulativeValues":{const e=_.Z.t("Not supported when using cumulative values");t===f.Zp&&i&&(n.colTotals={},n.colSubTotals={},n.rowTotals={},n.rowSubTotals={},n.numberType={helpText:e},n.legend={helpText:e});break}}return n})({visType:l.type,options:F(l)}),t=(0,C.Z)(l);Object.keys(e).forEach((e=>delete t[e])),q(t);(async()=>{var e,a,n,i,l,s,d,u;const{responses:c,extraOptions:p}=await Q(t,o,r),m=(null===(e=c[0].metaData.dimensions)||void 0===e?void 0:e.dx)||[];if(Boolean(null===(a=t.icons)||void 0===a?void 0:a.length)&&m[0]&&null!==(n=c[0].metaData.items[m[0]])&&void 0!==n&&null!==(i=n.style)&&void 0!==i&&i.icon){const e=await fetch(c[0].metaData.items[m[0]].style.icon),t=(await e.text()).replaceAll("#333333","currentColor");p.icon=t}const v=[];switch(null===(l=t.legend)||void 0===l?void 0:l.strategy){case b.zv:null!==(s=t.legend)&&void 0!==s&&null!==(d=s.set)&&void 0!==d&&d.id&&v.push(t.legend.set.id);break;case b.EE:m.forEach((e=>{const t=c[0].metaData.items[e].legendSet;t&&v.push(t)}))}const h=await X(v);I({visualization:t,legendSets:h,responses:c,extraOptions:p}),$(null===(u=t.legend)||void 0===u?void 0:u.showKey),E()})().catch((e=>{v(e)}))}),[l,o,r]),!P||!N)return null;const ee=null==L?void 0:L.getBoundingClientRect(),te=ee?{getBoundingClientRect:()=>ee}:null;let ae=[];switch(null===(t=P.visualization.legend)||void 0===t?void 0:t.strategy){case b.EE:{if(P.visualization.type!==f.Zp&&!P.visualization.columns.some((e=>e.dimension===h.a5)))break;const e=Object.values(P.responses[0].metaData.items).filter((e=>P.legendSets.map((e=>e.id)).includes(e.legendSet))).map((e=>({itemId:e.uid,legendSet:e.legendSet}))),t=(P.visualization.series||[]).filter((e=>e.type===f.Cj)).map((e=>e.dimensionItem));ae=P.legendSets.filter((a=>e.filter((e=>!t.includes(e.itemId))).map((e=>e.legendSet)).includes(a.id)))}break;case b.zv:ae=P.legendSets}const ne=(null===(a=ae)||void 0===a?void 0:a.length)>0&&(0,f.Dm)(P.visualization.type);let ie=c;r&&ne?ie={...c,width:c.width||K.width-(W?200:36)}:u&&(ie={...c,width:c.width||K.width,height:c.height||K.height}),ie.height||(ie.height=K.height||"100%"),ie.width||(ie.width=K.width||"100%");return m.createElement("div",{className:T()(kt,{[Vt]:u}),ref:H},m.createElement("div",{className:qt},P.visualization.type&&P.visualization.type!==f.Zp?P.visualization.type===f.h0?m.createElement(_t,{visualization:(0,w.C)(N,P.visualization),responses:P.responses,filters:o,id:d,style:ie,onDataSorted:O}):m.createElement(Be,{visualization:(0,w.C)(N,P.visualization),responses:P.responses,extraOptions:P.extraOptions,legendSets:ae,onToggleContextualMenu:M?Y:void 0,id:r?U:d,onChartGenerated:p,style:ie}):m.createElement(Mt,{visualization:(0,w.C)(N,P.visualization),responses:P.responses,legendSets:ae,onToggleContextualMenu:M?Y:void 0,id:d,style:ie})),ne&&r?m.createElement(m.Fragment,null,W&&m.createElement("div",{className:Nt,"data-test":"visualization-legend-key"},m.createElement("div",{className:T()(Pt,It)},m.createElement(y.Z,{legendSets:ae}))),m.createElement("div",{className:Rt},m.createElement(x.z,{small:!0,secondary:!0,onClick:()=>{$(!W),G(U+1)},icon:m.createElement(S.Z,null),toggled:W}))):ne&&null!==(le=P.visualization.legend)&&void 0!==le&&le.showKey?m.createElement("div",{className:Nt,"data-test":"visualization-legend-key"},m.createElement("div",{className:Pt},m.createElement(y.Z,{legendSets:ae}))):void 0,ee&&m.createElement(i.m,{onClick:J,dataTest:"visualization-drill-down-backdrop"},m.createElement(it,{reference:te,config:A,ouLevels:N,onClick:e=>{J(),M(e)},dataTest:"visualization-drill-down-menu"})));var le};function Zt(){return Zt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Zt.apply(this,arguments)}Lt.defaultProps={displayProperty:"name",filters:{},forDashboard:!1,onChartGenerated:Function.prototype,onError:Function.prototype,onLoadingComplete:Function.prototype,onDataSorted:Function.prototype,onResponsesReceived:Function.prototype,style:{},visualization:{}},Lt.propTypes={displayProperty:p().string.isRequired,visualization:p().object.isRequired,filters:p().object,forDashboard:p().bool,id:p().number,isInModal:p().bool,style:p().object,onChartGenerated:p().func,onDataSorted:p().func,onDrill:p().func,onError:p().func,onLoadingComplete:p().func,onResponsesReceived:p().func};const At=e=>{const[t,a]=(0,m.useState)(e),[n,i]=(0,m.useState)(!0),o=(0,m.useCallback)((e=>{i(!0);const n={dimension:e.dimension,direction:e.direction.toUpperCase()};a({...t,visualization:{...t.visualization,sorting:[n]}})}),[t]);(0,m.useEffect)((()=>{a({displayProperty:e.displayProperty,visualization:e.visualization,filters:e.filters,forDashboard:e.forDashboard,id:e.id,isInModal:e.isInModal,style:e.style,onChartGenerated:e.onChartGenerated,onDrill:e.onDrill,onError:e.onError,onResponsesReceived:e.onResponsesReceived})}),[e.displayProperty,e.visualization,e.filters,e.forDashboard,e.id,e.isInModal,e.style,e.onChartGenerated,e.onDrill,e.onError,e.onResponsesReceived]),(0,m.useEffect)((()=>{i(!0)}),[e.filters,e.forDashboard,e.visualization]);return m.createElement(m.Fragment,null,n&&m.createElement(v.Y,null,m.createElement(l.M,null,m.createElement(s.V,null))),m.createElement(Lt,Zt({},t,{onDataSorted:o,onLoadingComplete:()=>i(!1)})))};At.propTypes={displayProperty:p().string.isRequired,visualization:p().object.isRequired,className:p().string,filters:p().object,forDashboard:p().bool,id:p().number,isInModal:p().bool,style:p().object,onChartGenerated:p().func,onDrill:p().func,onError:p().func,onResponsesReceived:p().func};const jt="READY",Wt="INSTALLING";function $t(e){let{installingWorker:t,onStateChange:a}=e;t.onstatechange=()=>{"activated"===t.state&&a(jt)}}function Ut(){return Ut=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Ut.apply(this,arguments)}const Gt=()=>m.createElement(i.m,null,m.createElement(l.M,null,m.createElement(s.V,null))),Ft=e=>{let{id:t,children:a,cacheNow:i,isParentCached:l}=e;const{startRecording:s,isCached:o,remove:r}=(0,n.Of)(t);return(0,m.useEffect)((()=>{i&&s({onError:console.error})}),[i]),(0,m.useEffect)((()=>{const e=d().on("removeCachedData",{window:window.parent},(()=>r()));return()=>e.cancel()}),[r]),(0,m.useEffect)((()=>{!l&&o&&r()}),[l]),m.createElement(n.MW,{id:t,loadingMask:Gt},a)};Ft.propTypes={cacheNow:p().bool,children:p().node,id:p().string,isParentCached:p().bool};const Kt=e=>{d().send(window.parent,"installationStatus",{installationStatus:e})},Bt=()=>{const[e,t]=(0,m.useState)(),[a,n]=(0,m.useState)(null),i=e=>t(e.data);return(0,m.useEffect)((()=>{d().send(window.parent,"getProps").then(i).catch((e=>console.error(e))),async function(e){let{onStateChange:t}=e;if(!navigator.serviceWorker)return null;const a=await navigator.serviceWorker.getRegistration();return a?a.active?jt:a.installing?($t({installingWorker:a.installing,onStateChange:t}),Wt):(a.onupdatefound=()=>{t(Wt);const e=a.installing;e&&$t({installingWorker:e,onStateChange:t})},null):null}({onStateChange:Kt}).then(Kt);const e=d().on("newProps",{window:window.parent},i);return()=>e.cancel()}),[]),(0,m.useLayoutEffect)((()=>{const e=(0,u.Z)((()=>n((e=>"number"==typeof e?e+1:1))),300);return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),e?m.createElement("div",{style:{display:"flex",height:"100%",overflow:"hidden"}},m.createElement(Ft,{id:e.cacheId,cacheNow:e.recordOnNextLoad,isParentCached:e.isParentCached},m.createElement(At,Ut({id:a},e))),m.createElement(o.k,{colors:!0,spacers:!0,elevations:!0})):null}},2480:()=>{},5042:()=>{}}]);