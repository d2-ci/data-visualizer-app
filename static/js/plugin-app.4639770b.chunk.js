(self.webpackChunkdata_visualizer_app=self.webpackChunkdata_visualizer_app||[]).push([[2143],{3683:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>we});var n=a(3135),s=a(8594),l=a(4479),i=a(6329),r=a(3338),o=a(1006),u=a.n(o),d=a(4833),c=a(3665),p=a.n(c),g=a(2085),v=a(4805),f=a(6609),m=a(2703),h=a(2644),b=a(9551),y=a(7427),w=a(7538),E=a(1054),S=a(6206),D=a.n(S),V=a(3491);const q={resource:"legendSets",params:e=>{let{ids:t}=e;return{fields:"id,displayName~rename(name),legends[id,displayName~rename(name),startValue,endValue,color]",filter:`id:in:[${t.join(",")}]`}}};var C=a(6259);var z=a(2229),O=a(4048),P=a(4110),x=a(7363),k=a(8943);const T=e=>(0,k.CU)(x.fW).getPeriods().find((t=>t.id===e[0].id))?x.fW:(0,k.CU)(x.O5).getPeriods().find((t=>t.id===e[0].id))?x.O5:void 0,L=v.vi,R=async(e,t,a)=>{const n=P.Z.getAnalytics(e),s=(new n.request).fromVisualization(t).withParameters(a).withIncludeNumDen(t.type===h.Zp),l=await n.aggregate.get(s);return[new n.response(l)]},j=e=>{let{yearlySeriesRes:t,currentMonth:a,currentDay:n}=e;const s=[],l=[],i=t.metaData.dimensions[L].slice().sort().reverse(),r="02"===a&&"29"===n;return i.forEach((e=>{s.push(t.metaData.items[e].name);const i=29===new Date(e,1,29).getDate();r&&!i?l.push(`${e}-02-28`):l.push(`${e}-${a}-${n}`)})),{yearlySeriesLabels:s,periodDates:l}},M=async e=>{let{analyticsEngine:t,visualization:a,options:n,yearlySeriesRes:s,currentMonth:l,currentDay:i}=e;const r=[],o=[],u=s.metaData.dimensions[L].slice().sort().reverse(),d=u.shift();r.push(s.metaData.items[d].name),o.push(`${d}-${l}-${i}`);const c=(new t.request).fromVisualization(a).withParameters(n).withRelativePeriodDate(`${d}-${l}-${i}`).withSkipData(!0).withSkipMeta(!1),p=(await t.aggregate.fetch(c)).metaData.dimensions[L].pop(),[g,v]=p.split("W"),f=d-g,m=u.reduce(((e,t)=>(r.push(s.metaData.items[t].name),e.push(`${t-f}W${v}`),"53"===v&&e.push(t-f+"W52"),e)),[]);if(m.length){const e=(new t.request).addPeriodDimension(m).withSkipData(!0).withSkipMeta(!1).withIncludeMetadataDetails(!0),a=await t.aggregate.fetch(e),n=[];a.metaData.dimensions[L].sort().reverse().forEach((e=>{const t=e.substr(0,4);if(!n.includes(t)){const s=new Date(a.metaData.items[e].endDate);s.setDate(s.getDate()+1),o.push(`${s.getFullYear()}-${(""+(s.getMonth()+1)).padStart(2,0)}-${(""+s.getDate()).padStart(2,0)}`),n.unshift(t)}}))}return{yearlySeriesLabels:r,periodDates:o}};var $=a(222),N=a(3353);const W={axes:{requestable:!1,savable:!0,defaultValue:[]},colorSet:{defaultValue:$.C7,requestable:!1,savable:!0},cumulativeValues:{defaultValue:!1,requestable:!1,savable:!0},hideEmptyRowItems:{defaultValue:"NONE",requestable:!1,savable:!0},seriesKey:{defaultValue:{},requestable:!1,savable:!0},legend:{defaultValue:{},requestable:!1,savable:!0},noSpaceBetweenColumns:{defaultValue:!1,requestable:!1,savable:!0},percentStackedValues:{defaultValue:!1,requestable:!1,savable:!0},regressionType:{defaultValue:"NONE",requestable:!1,savable:!0},showData:{defaultValue:!0,requestable:!1,savable:!0},aggregationType:{defaultValue:"DEFAULT",requestable:!0,savable:!0},completedOnly:{defaultValue:!1,requestable:!0,savable:!0},hideSubtitle:{defaultValue:!1,requestable:!1,savable:!0},hideTitle:{defaultValue:!1,requestable:!1,savable:!0},sortOrder:{defaultValue:"0",requestable:!1,savable:!0},subtitle:{defaultValue:void 0,requestable:!1,savable:!0},title:{defaultValue:void 0,requestable:!1,savable:!0},series:{defaultValue:[],requestable:!1,savable:!0},fontStyle:{defaultValue:{},requestable:!1,savable:!0},outlierAnalysis:{requestable:!1,savable:!0,defaultValue:null},icons:{defaultValue:!1,requestable:!1,savable:!0},colTotals:{defaultValue:!1,requestable:!1,savable:!0},colSubTotals:{defaultValue:!1,requestable:!1,savable:!0},rowTotals:{defaultValue:!1,requestable:!1,savable:!0},rowSubTotals:{defaultValue:!1,requestable:!1,savable:!0},showDimensionLabels:{defaultValue:!1,requestable:!1,savable:!0},hideEmptyColumns:{defaultValue:!1,requestable:!1,savable:!0},hideEmptyRows:{defaultValue:!1,requestable:!1,savable:!0},skipRounding:{defaultValue:!1,requestable:!0,savable:!0},numberType:{defaultValue:"VALUE",requestable:!1,savable:!0},showHierarchy:{defaultValue:!1,requestable:!0,savable:!0},displayDensity:{defaultValue:"NORMAL",requestable:!1,savable:!0},fontSize:{defaultValue:"NORMAL",requestable:!1,savable:!0},digitGroupSeparator:{defaultValue:"SPACE",requestable:!1,savable:!0},approvalLevel:{defaultValue:void 0,requestable:!0,savable:!1},fixColumnHeaders:{defaultValue:!1,requestable:!1,savable:!0},fixRowHeaders:{defaultValue:!1,requestable:!1,savable:!0},reportingPeriod:{defaultValue:!1,requestable:!1,savable:!0},organisationUnit:{defaultValue:!1,requestable:!1,savable:!0},parentOrganisationUnit:{defaultValue:!1,requestable:!1,savable:!0},grandParentOrganisationUnit:{defaultValue:!1,requestable:!1,savable:!0},regression:{defaultValue:!1,requestable:!1,savable:!0},cumulative:{defaultValue:!1,requestable:!1,savable:!0},measureCriteria:{defaultValue:void 0,requestable:!0,savable:!0},topLimit:{defaultValue:"0",requestable:!1,savable:!0}},I=()=>Object.entries(W).filter((e=>e[1].requestable)),_=e=>{var t;const a={...Object.entries({...W}).reduce(((e,t)=>{let[a,n]=t;return e[a]=n.defaultValue,e}),{}),...(0,N.Z)(e,Object.keys(W))};return a.axes=a.axes.map((e=>{if(e.targetLine||e.baseLine){const t={...e};return t.targetLine&&(t.targetLine={...t.targetLine,enabled:!0}),t.baseLine&&(t.baseLine={...t.baseLine,enabled:!0}),t}return e})),a.icons=Boolean(null===(t=e.icons)||void 0===t?void 0:t.length),e.reportingParams&&(a.organisationUnit=e.reportingParams.organisationUnit,a.reportingPeriod=e.reportingParams.reportingPeriod,a.parentOrganisationUnit=e.reportingParams.parentOrganisationUnit,a.grandParentOrganisationUnit=e.reportingParams.grandParentOrganisationUnit),["sortOrder","topLimit"].forEach((t=>{Object.prototype.hasOwnProperty.call(e,t)&&(a[t]=String(e[t]))})),a},Z=e=>(e||[]).map((e=>{var t;return{...e,items:null==e||null===(t=e.items)||void 0===t?void 0:t.filter((e=>e.id!==z.aW))}})),U=async e=>{let{dataEngine:t,visualization:a,filters:n,forDashboard:s,displayProperty:l}=e;const i={...a,columns:Z(a.columns),rows:Z(a.rows),filters:Z(a.filters)},r=((e,t,a)=>{const n=I().reduce(((t,a)=>{let[n,s]=a;return void 0!==e[n]&&e[n]!==s.defaultValue&&(t[n]=e[n]),t}),{});if(t.relativePeriodDate&&(n.relativePeriodDate=t.relativePeriodDate),a&&(n.displayProperty=a.toUpperCase()),t.userOrgUnit&&t.userOrgUnit.length){const e=t.userOrgUnit.map((e=>e.split("/").slice(-1)[0]));n.userOrgUnit=e.join(";")}return n})(i,n,l),o={dashboard:s};if((0,h.zD)(i.type)){const{responses:e,yearlySeriesLabels:a}=await(async(e,t,a)=>{const n=P.Z.getAnalytics(e);let s=(new n.request).addPeriodDimension(t.yearlySeries).withSkipData(!0).withSkipMeta(!1).withIncludeMetadataDetails(!0);a.relativePeriodDate&&(s=s.withRelativePeriodDate(a.relativePeriodDate));const l=await n.aggregate.fetch(s),i=[],r=[],o=new Date,u=(""+o.getDate()).padStart(2,0),d=(""+(o.getMonth()+1)).padStart(2,0),c=(0,O.Z)(t,L);if(T(c)===x.fW&&!c[0].id===x.uu){const e=await M({analyticsEngine:n,visualization:t,options:a,yearlySeriesRes:l,currentMonth:d,currentDay:u});i.push(...e.periodDates),r.push(...e.yearlySeriesLabels)}else if(T(c)===x.O5){const e=j({yearlySeriesRes:l,currentMonth:d,currentDay:u});i.push(...e.periodDates),r.push(...e.yearlySeriesLabels)}else l.metaData.dimensions[L].sort().reverse().forEach((e=>{r.push(l.metaData.items[e].name),i.push(`${e}-${d}-${u}`)}));const p=i.reduce(((e,s)=>{const l=(new n.request).fromVisualization(t).withParameters(a).withRelativePeriodDate(s);return e.push(n.aggregate.get(l)),e}),[]);return Promise.all(p).then((e=>({responses:e.map((e=>new n.response(e))),yearlySeriesLabels:r})))})(t,i,r),n=(0,O.Z)(i,v.vi),s=T(n),l=((e,t)=>{const a=e.reduce(((e,t)=>(e.push(t.metaData.dimensions.pe),e)),[]);if(t===x.O5){a.sort(((e,t)=>e[0].substr(-2)-t[0].substr(-2)));const e=a.shift().map((e=>[e]));return a.forEach((t=>{t.forEach((t=>{const a=t.match(/(\d{4})(\d{2})(\d{2})/),n=a[2],s=a[3],l=e.findIndex((e=>e[0].substr(4)===`${n}${s}`));if(-1!==l)e[l].push(t);else if("02"===n&&"29"===s){const a=e.findIndex((e=>-1!==e.findIndex((e=>/0228$/.test(e)))));-1!==a?e.splice(a+1,0,[t]):e.push([t])}else e.push([t])}))})),e}if(t===x.fW){a.sort(((e,t)=>t[0].split("W")[1]-e[0].split("W")[1]));const e=a.shift().map((e=>[e]));return a.forEach((t=>{t.forEach((t=>{const[a,n]=t.split("W"),s=e.findIndex((e=>e[0].split("W")[1]===n));if(-1!==s)e[s].push(t);else if("1"===n){const a=e.findIndex((e=>-1!==e.findIndex((e=>/W2$/.test(e)))));-1!==a?e[a].push(t):e.push([t])}else{const s=e.findIndex((e=>-1!==e.findIndex((e=>e===`${a}W${n-1}`))));e.splice(s+1,0,[t])}}))})),e}{const e=a.reduce(((e,t)=>(t.forEach(((t,a)=>{e[a].push(t)})),e)),Array.from({length:a[0].length},(()=>[])));return e}})(e,s),u=l.reduce(((e,t,a)=>(t.forEach((t=>e[t]=a)),e)),{}),d=s?((e,t)=>{switch(t){case x.fW:return e.map((e=>e[0].substr(4))).flat();case x.O5:return e.map((e=>e[0].substr(4).replace(/(\d{2})(\d{2})/,"$2-$1"))).flat()}})(l,s):(e=>{const t=e.reduce(((e,t)=>(e.metaData?t.metaData.dimensions.pe.length>e.metaData.dimensions.pe.length&&(e=t):e=t,e)),{}).metaData;return t.dimensions.pe.reduce(((e,a)=>{const n=t.items[a].name;return e.push(n.replace(/\s+\d{4}$/,"")),e}),[])})(e);return{responses:e,extraOptions:{...o,yearlySeries:a,xAxisLabels:d,periodKeyAxisIndexMap:u}}}return{responses:await R(t,i,r),extraOptions:o}};var A=a(5282);const F=e=>{let{visualization:t,responses:a,extraOptions:n,legendSets:s,id:l,style:i,onChartGenerated:r,animation:o,onToggleContextualMenu:u}=e;const d=(0,g.useRef)(void 0),c=(0,g.useRef)(i),p=(0,g.useRef)(l),v=(0,g.useCallback)((e=>{const l=(0,A.cw)(a,t,d.current,{...n,animation:e,legendSets:s,onToggleContextualMenu:u},void 0,void 0,(0,h.Nh)(t.type)?"dhis":"highcharts");(0,h.Nh)(t.type)?r(l.visualization):r(l.visualization.getSVGForExport({sourceHeight:768,sourceWidth:1024}))}),[d,t,r,u,a,n,s]);return(0,g.useEffect)((()=>{v(o)}),[t,a,n]),(0,g.useEffect)((()=>{l!==p.current&&(v(0),p.current=l)}),[l]),(0,g.useEffect)((()=>{i.width===c.current.width&&i.height===c.current.height||(v(0),c.current=i)}),[i]),g.createElement("div",{ref:d,style:i})};F.defaultProps={visualization:{},filters:{},style:{},animation:200,id:null,onChartGenerated:Function.prototype},F.propTypes={extraOptions:p().object.isRequired,legendSets:p().arrayOf(p().object).isRequired,responses:p().arrayOf(p().object).isRequired,visualization:p().object.isRequired,animation:p().number,id:p().number,style:p().object,onChartGenerated:p().func,onToggleContextualMenu:p().func};const G=F;var B=a(4196),H=a(9676),K=a(1463),Y=a(4813);const Q=e=>{let{style:t={width:18,height:18}}=e;return g.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",style:t},g.createElement("path",{d:"M0 0h24v24H0V0z",fill:"none"}),g.createElement("path",{d:"M20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8 8-8z",fill:"black"}))};Q.propTypes={style:p().object};const J=Q,X=e=>{let{style:t={width:18,height:18}}=e;return g.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",style:t},g.createElement("path",{d:"M0 0h24v24H0V0z",fill:"none"}),g.createElement("path",{d:"M4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8-8 8z",fill:"black"}))};X.propTypes={style:p().object};const ee=X,te=e=>{let{config:t,ouLevels:a,onClick:s,reference:l,dataTest:i}=e;const r=(0,n.bQ)(),[o,u]=(0,g.useState)(void 0),[d,c]=(0,g.useState)(void 0),p=(0,g.useCallback)((async e=>await(0,f.M7)(r,e)),[r]);(0,g.useEffect)((()=>{u(null);t.ouId&&(async()=>{const e=await p(t.ouId);u(e)})()}),[t]),(0,g.useEffect)((()=>{if(c(null),null!=o&&o.children.length){const t=(e=o.children[0].level,a.find((t=>t.level===e)));t&&c(t)}var e}),[o]);const v={display:"inline-block",minWidth:200};return o?g.createElement(B.r,{reference:l,placement:"right-start",dataTest:i},g.createElement(H.q,null,g.createElement(K.s,{dense:!0,label:C.Z.t("Change org unit"),dataTest:`${i}-org-unit`},(null==o?void 0:o.parent)&&g.createElement(g.Fragment,null,g.createElement(K.s,{dense:!0,icon:g.createElement(ee,null),label:g.createElement("span",{style:v},o.parent.name),onClick:()=>s({ou:{id:o.parent.id}}),dataTest:`${i}-org-unit-drill-up`}),d&&g.createElement(Y.i,null)),d&&g.createElement(K.s,{dense:!0,icon:g.createElement(J,null),label:g.createElement("span",{style:v},C.Z.t("{{level}} level in {{orgunit}}",{level:d.name,orgunit:o.name})),onClick:()=>s({ou:{id:o.id,path:o.path,level:d.id}}),dataTest:`${i}-org-unit-drill-down`})))):null};te.propTypes={config:p().object,dataTest:p().string,ouLevels:p().array,reference:p().object,onClick:p().func};const ae=te;var ne=a(4521);const se=e=>{let{responses:t,legendSets:a,visualization:n,style:s,id:l,onToggleContextualMenu:i}=e;return g.createElement("div",{style:s},g.createElement(ne.Z,{visualization:n,data:t[0].response,legendSets:a,renderCounter:l,onToggleContextualMenu:i}))};se.defaultProps={style:{}},se.propTypes={legendSets:p().arrayOf(p().object).isRequired,responses:p().arrayOf(p().object).isRequired,visualization:p().object.isRequired,id:p().number,style:p().object,onToggleContextualMenu:p().func};const le=se,ie="VisualizationPlugin_container__zLI-6",re="VisualizationPlugin_chartWrapper__qJc7d",oe="VisualizationPlugin_legendKey__rY4a7",ue="VisualizationPlugin_legendKeyToggle__yN1ab",de="VisualizationPlugin_wrapper__qtDqn",ce="VisualizationPlugin_buttonMargin__Zo0d5",pe=e=>{var t,a;let{visualization:l,displayProperty:i,filters:r,forDashboard:o,id:u,style:d,onChartGenerated:c,onError:p,onLoadingComplete:S,onResponsesReceived:z,onDrill:O}=e;const P=(0,n.bQ)(),[x,k]=(0,g.useState)(void 0),[T,L]=(0,g.useState)(void 0),[R,j]=(0,g.useState)(null),[M,$]=(0,g.useState)(void 0),[N,W]=(0,g.useState)({}),[I,Z]=(0,g.useState)(!1),[A,F]=(0,g.useState)(u),[B,H]=(0,g.useState)({width:0,height:0}),K=(0,g.useCallback)((e=>{if(null===e||0===e.clientWidth&&0===e.clientHeight)return;const t=()=>H({width:e.clientWidth,height:e.clientHeight}),a=new window.ResizeObserver(t);return a.observe(e),t(),a.disconnect}),[]);(0,g.useEffect)((()=>F(u)),[u]);const Y=(e,t)=>{if(t.ouId)W(t),$(e);else if(t.category&&(1===x.rows.length&&x.rows[0].dimension===v.rx||2===x.rows.length&&x.rows[1].dimension===v.rx)){var a;const n=null===(a=Object.values(R.responses[0].metaData.items).find((e=>e.name===t.category&&R.responses[0].metaData.dimensions[v.rx].includes(e.uid))))||void 0===a?void 0:a.uid;W({ouId:n}),$(e)}else if(t.category&&x.columns.some((e=>e.dimension===v.rx))){var n;const a=null===(n=Object.values(R.responses[0].metaData.items).find((e=>e.name===t.series&&R.responses[0].metaData.dimensions[v.rx].includes(e.uid))))||void 0===n?void 0:n.uid;W({ouId:a}),$(e)}},Q=()=>$(void 0),J=(0,g.useCallback)((async(e,t,a)=>{const n=await U({dataEngine:P,visualization:e,filters:t,forDashboard:a,displayProperty:i});return n.responses.length&&z(n.responses),n}),[P,i,z]),X=(0,g.useCallback)((async e=>{if(!e.length)return[];return await(async(e,t)=>(await e.query({legendSets:q},{variables:{ids:t}})).legendSets.legendSets)(P,e)}),[P]);if((0,g.useEffect)((()=>{(async()=>{const e=await(0,f.qB)(P);L(e)})()}),[P]),(0,g.useEffect)((()=>{j(null);const e=(e=>{let{visType:t,options:a}=e;const n={};for(const[e,s]of Object.entries(a))switch(e){case"cumulativeValues":{const e=C.Z.t("Not supported when using cumulative values");t===h.Zp&&s&&(n.colTotals={},n.colSubTotals={},n.rowTotals={},n.rowSubTotals={},n.numberType={helpText:e},n.legend={helpText:e});break}}return n})({visType:l.type,options:_(l)}),t=(0,V.Z)(l);Object.keys(e).forEach((e=>delete t[e])),k(t);(async()=>{var e,a,n,s,l,i,u;const{responses:d,extraOptions:c}=await J(t,r,o),p=d[0].metaData.dimensions.dx||[];if(Boolean(null===(e=t.icons)||void 0===e?void 0:e.length)&&p[0]&&null!==(a=d[0].metaData.items[p[0]])&&void 0!==a&&null!==(n=a.style)&&void 0!==n&&n.icon){const e=await fetch(d[0].metaData.items[p[0]].style.icon),t=(await e.text()).replaceAll("#333333","currentColor");c.icon=t}const g=[];switch(null===(s=t.legend)||void 0===s?void 0:s.strategy){case m.zv:null!==(l=t.legend)&&void 0!==l&&null!==(i=l.set)&&void 0!==i&&i.id&&g.push(t.legend.set.id);break;case m.EE:p.forEach((e=>{const t=d[0].metaData.items[e].legendSet;t&&g.push(t)}))}const v=await X(g);j({visualization:t,legendSets:v,responses:d,extraOptions:c}),Z(null===(u=t.legend)||void 0===u?void 0:u.showKey),S()})().catch((e=>{p(e)}))}),[l,r,o]),!R||!T)return null;const ee=null==M?void 0:M.getBoundingClientRect(),te=ee?{getBoundingClientRect:()=>ee}:null;let ne=[];switch(null===(t=R.visualization.legend)||void 0===t?void 0:t.strategy){case m.EE:{if(R.visualization.type!==h.Zp&&!R.visualization.columns.some((e=>e.dimension===v.a5)))break;const e=Object.values(R.responses[0].metaData.items).filter((e=>R.legendSets.map((e=>e.id)).includes(e.legendSet))).map((e=>({itemId:e.uid,legendSet:e.legendSet}))),t=(R.visualization.series||[]).filter((e=>e.type===h.Cj)).map((e=>e.dimensionItem));ne=R.legendSets.filter((a=>e.filter((e=>!t.includes(e.itemId))).map((e=>e.legendSet)).includes(a.id)))}break;case m.zv:ne=R.legendSets}const se=(null===(a=ne)||void 0===a?void 0:a.length)>0&&(0,h.Dm)(R.visualization.type),pe=o&&se?{...d,width:d.width||B.width-(I?200:36)}:d;pe.height||(pe.height=B.height||"100%");return g.createElement("div",{className:ie,ref:K},g.createElement("div",{className:re},R.visualization.type&&R.visualization.type!==h.Zp?g.createElement(G,{visualization:(0,y.C)(T,R.visualization),responses:R.responses,extraOptions:R.extraOptions,legendSets:ne,onToggleContextualMenu:O?Y:void 0,id:o?A:u,onChartGenerated:c,style:pe}):g.createElement(le,{visualization:(0,y.C)(T,R.visualization),responses:R.responses,legendSets:ne,onToggleContextualMenu:O?Y:void 0,id:u,style:pe})),se&&o?g.createElement(g.Fragment,null,I&&g.createElement("div",{className:oe,"data-test":"visualization-legend-key"},g.createElement("div",{className:D()(de,ce)},g.createElement(b.Z,{legendSets:ne}))),g.createElement("div",{className:ue},g.createElement(w.z,{small:!0,secondary:!0,onClick:()=>{Z(!I),F(A+1)},icon:g.createElement(E.Z,null),toggled:I}))):se&&null!==(ge=R.visualization.legend)&&void 0!==ge&&ge.showKey?g.createElement("div",{className:oe,"data-test":"visualization-legend-key"},g.createElement("div",{className:de},g.createElement(b.Z,{legendSets:ne}))):void 0,ee&&g.createElement(s.m,{onClick:Q,dataTest:"visualization-drill-down-backdrop"},g.createElement(ae,{reference:te,config:N,ouLevels:T,onClick:e=>{Q(),O(e)},dataTest:"visualization-drill-down-menu"})));var ge};pe.defaultProps={displayProperty:"name",filters:{},forDashboard:!1,onChartGenerated:Function.prototype,onError:Function.prototype,onLoadingComplete:Function.prototype,onResponsesReceived:Function.prototype,style:{},visualization:{}},pe.propTypes={displayProperty:p().string.isRequired,visualization:p().object.isRequired,filters:p().object,forDashboard:p().bool,id:p().number,style:p().object,onChartGenerated:p().func,onDrill:p().func,onError:p().func,onLoadingComplete:p().func,onResponsesReceived:p().func};const ge="READY",ve="INSTALLING";function fe(e){let{installingWorker:t,onStateChange:a}=e;t.onstatechange=()=>{"activated"===t.state&&a(ge)}}function me(){return me=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},me.apply(this,arguments)}const he=()=>g.createElement(s.m,null,g.createElement(l.M,null,g.createElement(i.V,null))),be=e=>{let{id:t,children:a,cacheNow:s,isParentCached:l}=e;const{startRecording:i,isCached:r,remove:o}=(0,n.Of)(t);return(0,g.useEffect)((()=>{s&&i({onError:console.error})}),[s]),(0,g.useEffect)((()=>{const e=u().on("removeCachedData",{window:window.parent},(()=>o()));return()=>e.cancel()}),[o]),(0,g.useEffect)((()=>{!l&&r&&o()}),[l]),g.createElement(n.MW,{id:t,loadingMask:he},a)};be.propTypes={cacheNow:p().bool,children:p().node,id:p().string,isParentCached:p().bool};const ye=e=>{u().send(window.parent,"installationStatus",{installationStatus:e})},we=()=>{const[e,t]=(0,g.useState)(),[a,n]=(0,g.useState)(null),s=e=>t(e.data);return(0,g.useEffect)((()=>{u().send(window.parent,"getProps").then(s).catch((e=>console.error(e))),async function(e){let{onStateChange:t}=e;if(!navigator.serviceWorker)return null;const a=await navigator.serviceWorker.getRegistration();return a?a.active?ge:a.installing?(fe({installingWorker:a.installing,onStateChange:t}),ve):(a.onupdatefound=()=>{t(ve);const e=a.installing;e&&fe({installingWorker:e,onStateChange:t})},null):null}({onStateChange:ye}).then(ye);const e=u().on("newProps",{window:window.parent},s);return()=>e.cancel()}),[]),(0,g.useLayoutEffect)((()=>{const e=(0,d.Z)((()=>n((e=>"number"==typeof e?e+1:1))),300);return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),e?g.createElement("div",{style:{display:"flex",height:"100%",overflow:"hidden"}},g.createElement(be,{id:e.cacheId,cacheNow:e.recordOnNextLoad,isParentCached:e.isParentCached},g.createElement(pe,me({id:a},e))),g.createElement(r.k,{colors:!0,spacers:!0,elevations:!0})):null}},2480:()=>{},5042:()=>{}}]);